## message delivery semantics
- https://docs.confluent.io/kafka/design/delivery-semantics.html
- at least once, exactly-once 와 같은 개념이다.
- producer <-> broker, broker <-> consumer 의 두 구간에 대해 고민해야 한다.

### at least once

### exactly once

## 참고자료
- https://oliveyoung.tech/2024-10-16/oliveyoung-scm-oms-kafka/

## min.insync.replicas, replication factor
### 1. `replication.factor` (복제 계수)
- **정의**: 각 파티션에 대해 유지할 **복제본(replica)**의 수.
- **역할**: 데이터의 **내구성(durability)**과 **가용성(availability)** 보장.
- **예**:
  - `replication.factor=3` → 3개의 복제본 유지.
---
### 2. `min.insync.replicas` (최소 동기화 복제본)
- **정의**: 데이터 쓰기 성공을 위해 **동기화된(in-sync)** 복제본의 최소 수.
- **역할**: 데이터 손실 방지와 쓰기 안정성 보장.
- **예**:
  - `min.insync.replicas=2` → 최소 2개의 복제본이 동기화 상태여야 쓰기 성공.
---
### 3. 관계
- `min.insync.replicas`는 항상 `replication.factor`보다 작거나 같아야 함.
- 쓰기 성공 조건:
  - **`acks=all`** 설정 시, 리더와 최소 `min.insync.replicas`가 데이터 동기화 완료.
---

### cf. AWS, Azure managed kafka
- AWS mks: replication factor, min.insync.replicas 는 사용자가 설정 가능하다.
- Azure event hubs: replication factor = 3 이고, 두 값 모두 사용자가 설정 불가능하다.

---

## consumer 관련
- group.id: consumer group 을 지정한다.
- auto.offset.reset: earliest, latest -> offset 이 없는 경우 파티션의 처음부터/마지막부터 메시지를 읽을지
- enable.auto.commit: offset 자동 커밋 또는 코드로 커밋
- auto.commit.interval.ms: offset 자동 커밋할 경우 interval

---

## message
- key: 저장될 partition 을 결정한다.
- schema: Avro, Json, XML 등이 있다. (trade-off)
  - Avro 는 가볍고 성능이 좋다. Json 은 무겁지만 개발하기가 쉽다.

---

## SASL 인증
- tls 와 sasl 을 함께 사용할 수 있다.
- sasl 메커니즘 옵션에 따라 작동 방식이 다르다.

### 예시: Kafka SASL/PLAIN 인증 검증 과정

#### 1. 클라이언트 인증 요청
- 클라이언트는 Kafka 브로커에 연결 후 `\0username\0password` 형식으로 인증 요청.

#### 2. 브로커에서 JAAS 설정 확인
- 브로커는 `server.properties` 파일의 JAAS 설정으로 자격 증명을 검증:
  ```properties
  listener.name.sasl_plaintext.plain.sasl.jaas.config= \
    org.apache.kafka.common.security.plain.PlainLoginModule required \
    username="kafka_user" \
    password="kafka_password";
