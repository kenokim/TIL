# grafana loki
- Loki-Grafana 스택은 로그 데이터의 수집, 저장, 조회, 시각화를 위한 모니터링 스택입니다. 특히 Prometheus와 잘 통합되어 애플리케이션의 메트릭과 로그를 함께 관리할 수 있는 장점을 제공합니다. 주요 구성 요소와 작동 방식을 설명하겠습니다.

1. Loki
- Loki는 로그를 수집하고 저장하는 로그 집계 시스템입니다. Elasticsearch와 같은 복잡한 인덱스 구조가 필요하지 않고, 각 로그를 메타데이터와 함께 저장해 검색 시 메타데이터를 통해 필터링하고, 필요한 로그를 조회할 수 있습니다. 이로 인해 설치와 운영이 단순하며, 리소스 효율성도 높습니다. Loki는 Prometheus의 라벨링 시스템을 사용하므로 Prometheus와 동일한 라벨을 통해 로그와 메트릭을 쉽게 매핑할 수 있습니다.

2. Grafana
- Grafana는 Loki의 로그를 시각화하고 조회할 수 있는 도구입니다. Loki와의 통합을 통해 Grafana에서 로그를 쿼리하고, 실시간으로 로그를 모니터링할 수 있습니다. 또한, Prometheus 메트릭과 결합하여 특정 메트릭을 기반으로 로그를 탐색하는 기능을 제공합니다. 예를 들어, 애플리케이션의 에러 메트릭이 특정 임계치를 초과하면 해당 시점의 로그를 조회하여 원인을 파악하는 작업을 쉽게 할 수 있습니다.

3. Promtail
- Promtail은 Loki와 함께 사용되는 로그 수집기입니다. 각 노드에서 로그 파일을 읽고, 라벨을 추가한 후 Loki에 전송합니다. Kubernetes 환경에서 각 컨테이너의 로그를 수집해 라벨을 붙이는 작업을 자동화할 수 있어, 분산된 환경에서도 로그를 효율적으로 수집하고 관리할 수 있습니다.

### 작동 흐름
- 로그 수집: Promtail이 애플리케이션의 로그를 수집해 라벨과 함께 Loki에 전달합니다.
- 로그 저장: Loki는 라벨을 기반으로 로그를 저장하고 인덱싱 없이 효율적으로 관리합니다.
- 로그 조회 및 시각화: Grafana에서 Loki를 데이터 소스로 설정하면, 로그 데이터를 시각화하거나 메트릭과 결합해 쿼리할 수 있습니다.
- 문제 파악: Grafana 대시보드에서 Prometheus 메트릭과 Loki 로그를 함께 확인해 문제를 신속히 파악하고, 필요 시 알림을 설정해 실시간으로 대응할 수 있습니다.
- 이러한 구조로 Loki-Grafana 스택을 사용하면 로그와 메트릭을 통합 모니터링할 수 있어, 애플리케이션의 성능 및 장애 원인 분석에 큰 도움이 됩니다.

